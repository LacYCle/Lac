<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courser - 在线网课学习平台</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
</head>
<body>
    <header>
        <div class="container">
            <h1><span class="highlight">Courser</span> - 在线网课学习平台</h1>
            <p class="subtitle">基于前后端分离架构的现代化在线学习解决方案</p>
        </div>
    </header>

    <nav class="sticky-nav">
        <div class="container">
            <ul>
                <li><a href="#overview">项目概述</a></li>
                <li><a href="#core-modules">核心功能模块</a></li>
                <li><a href="#security-performance">系统安全与性能</a></li>
                <li><a href="#deployment">项目部署与维护</a></li>
                <li><a href="#summary">项目总结</a></li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <!-- 项目概述 -->
        <section id="overview" class="section">
            <div class="section-header">
                <h2><i class="fas fa-info-circle"></i> 项目概述</h2>
                <button class="toggle-btn" aria-label="展开/折叠内容">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <div class="overview-grid">
                    <div class="overview-item">
                        <h3>项目简介</h3>
                        <p>Courser 是一个基于前后端分离架构的在线网课学习平台。旨在为用户提供便捷的课程浏览、学习和管理体验。平台支持用户注册登录、课程搜索、课程详情查看、视频在线播放以及课程表的上传和解析等功能。</p>
                    </div>
                    <div class="overview-item">
                        <h3>技术栈</h3>
                        <div class="tech-stack">
                            <div class="tech-category">
                                <h4>前端</h4>
                                <ul>
                                    <li>HTML5, CSS3</li>
                                    <li>原生 JavaScript</li>
                                    <li>jQuery</li>
                                    <li>Bootstrap 5</li>
                                    <li>Font Awesome</li>
                                </ul>
                            </div>
                            <div class="tech-category">
                                <h4>后端</h4>
                                <ul>
                                    <li>Node.js</li>
                                    <li>Express.js</li>
                                    <li>MySQL</li>
                                    <li>JWT 认证</li>
                                    <li>Deepseek API</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="architecture">
                    <h3>系统架构</h3>
                    <div class="architecture-diagram">
                        <pre class="mermaid">
                            graph TD
                            A[客户端] -->|HTTP请求| B[Express服务器]
                            B -->|认证| C[JWT中间件]
                            B -->|数据存储| D[MySQL数据库]
                            B -->|文件上传| E[Multer中间件]
                            B -->|课程表解析| F[Deepseek API]
                            B -->|日志记录| G[Winston日志]
                            
                            subgraph 前端模块
                            A1[用户界面] --> A2[API服务]
                            A2 --> A3[认证模块]
                            A2 --> A4[课程管理]
                            end
                            
                            subgraph 后端模块
                            B1[控制器] --> B2[服务层]
                            B2 --> B3[模型层]
                            B3 --> D
                            end
                        </pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 核心功能模块 -->
        <section id="core-modules" class="section">
            <div class="section-header">
                <h2><i class="fas fa-puzzle-piece"></i> 核心功能模块详解</h2>
                <button class="toggle-btn" aria-label="展开/折叠内容">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <!-- 用户认证模块 -->
                <div class="module-card">
                    <div class="module-header">
                        <h3><i class="fas fa-user-lock"></i> 用户认证模块</h3>
                        <button class="toggle-code-btn" aria-label="显示/隐藏代码">
                            <i class="fas fa-code"></i> 查看代码
                        </button>
                    </div>
                    <div class="module-content">
                        <p>实现了基于JWT的安全用户认证系统，支持用户注册、登录和令牌刷新功能。采用bcrypt进行密码加密，确保用户数据安全。</p>
                        <div class="features-list">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>安全的密码加密存储</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>JWT令牌认证</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>令牌自动刷新机制</span>
                            </div>
                        </div>
                    </div>
                    <div class="code-block hidden">
                        <div class="code-tabs">
                            <button class="code-tab active" data-target="auth-backend">后端实现</button>
                            <button class="code-tab" data-target="auth-frontend">前端实现</button>
                        </div>
                        <div class="code-content">
                            <div class="code-panel active" id="auth-backend">
                                <pre><code class="language-javascript">/**
 * 用户认证控制器
 * 处理用户注册、登录等认证相关请求
 */
const { validationResult } = require('express-validator');
const jwt = require('jsonwebtoken');
const User = require('../models/User');

// 用户登录
exports.login = async (req, res) => {
  try {
    const { email, password } = req.body;

    // 验证用户
    const user = await User.authenticate(email, password);
    if (!user) {
      return res.status(401).json({ message: '邮箱或密码不正确' });
    }

    // 生成JWT令牌
    const token = jwt.sign(
      { id: user.id, email: user.email },
      JWT_SECRET,
      { expiresIn: process.env.JWT_EXPIRES_IN }
    );

    res.json({
      message: '登录成功',
      user,
      token
    });
  } catch (error) {
    res.status(500).json({ message: '服务器错误，请稍后重试' });
  }
};</code></pre>
                            </div>
                            <div class="code-panel" id="auth-frontend">
                                <pre><code class="language-javascript">/**
 * 用户认证模块
 */
const UserAuth = {
    // 处理登录表单提交
    handleLogin: function(event) {
        event.preventDefault();
        
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;
        
        // 调用API登录
        API.user.login({ email, password })
            .then(data => {
                // 保存用户信息和token
                const user = {
                    ...data.user,
                    token: data.token
                };
                
                this.currentUser = user;
                sessionStorage.setItem('userSession', JSON.stringify(user));
                
                this.updateUIForLoggedInUser();
                $('#loginModal').modal('hide');
                
                showSuccessMessage(`欢迎回来，${user.username}！`);
            })
            .catch(error => {
                showErrorMessage('登录失败：' + error.message);
            });
    }
};</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 课程表解析模块 -->
                <div class="module-card">
                    <div class="module-header">
                        <h3><i class="fas fa-table"></i> 课程表解析模块</h3>
                        <button class="toggle-code-btn" aria-label="显示/隐藏代码">
                            <i class="fas fa-code"></i> 查看代码
                        </button>
                    </div>
                    <div class="module-content">
                        <p>利用Deepseek API实现智能课程表解析，支持CSV和Excel格式的课程表上传和解析，自动提取课程名称和教师信息。</p>
                        <div class="features-list">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>多格式课程表支持</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>AI智能解析</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>自动去重处理</span>
                            </div>
                        </div>
                    </div>
                    <div class="code-block hidden">
                        <pre><code class="language-javascript">/**
 * Deepseek API 服务
 * 提供与Deepseek API交互的功能
 */
const { OpenAI } = require('openai');

// 创建OpenAI客户端实例
const openai = new OpenAI({
  baseURL: 'https://dashscope.aliyuncs.com/compatible-mode/v1',
  apiKey: DEEPSEEK_API_KEY
});

/**
 * 使用Deepseek解析课程表文件内容
 * @param {string} fileContent - 文件内容
 * @param {string} fileType - 文件类型 (csv, excel)
 * @returns {Promise<Array>} - 解析后的课程数据
 */
async function parseCourseSchedule(fileContent, fileType) {
  try {
    const completion = await openai.chat.completions.create({
      model: "qwen-plus",
      messages: [
        {
          role: "system",
          content: "你是一个专业的课程表解析助手，请帮我从课程表中提取出所有不重复的课程名称和教师名称，并以JSON格式返回。"
        },
        {
          role: "user",
          content: `这是一个${fileType === 'csv' ? 'CSV' : 'Excel'}格式的课程表文件内容：\n\n${fileContent}\n\n请提取出所有不同的课程（对于名称相同的课程只保留一项），并以JSON数组格式返回，每个课程包含title(课程名称)和teacher(教师姓名)字段。`
        },
      ]
    });

    // 从响应中提取JSON数据
    const assistantMessage = completion.choices[0].message.content;
    
    // 解析JSON
    const jsonMatch = assistantMessage.match(/```json\n([\s\S]*?)\n```/) || 
                      assistantMessage.match(/\[([\s\S]*?)\]/) ||
                      assistantMessage;
    
    const jsonContent = jsonMatch[1] || assistantMessage;
    const courses = JSON.parse(jsonContent.includes('[') ? jsonContent : `[${jsonContent}]`);
    
    // 处理课程数据
    const processedCourses = courses.map((course, index) => ({
      id: Date.now() + index,
      title: course.title || '未知课程',
      teacher: course.teacher || '未知教师'
    }));
    
    return processedCourses;
  } catch (error) {
    throw new Error('课程表解析失败，请稍后重试');
  }
}</code></pre>
                    </div>
                </div>

                <!-- 课程收藏模块 -->
                <div class="module-card">
                    <div class="module-header">
                        <h3><i class="fas fa-heart"></i> 课程收藏模块</h3>
                        <button class="toggle-code-btn" aria-label="显示/隐藏代码">
                            <i class="fas fa-code"></i> 查看代码
                        </button>
                    </div>
                    <div class="module-content">
                        <p>实现了课程收藏功能，支持添加和取消收藏，并提供丝滑的动画效果。收藏数据使用本地存储保存，确保页面刷新后仍能保持状态。</p>
                        <div class="features-list">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>本地存储持久化</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>动画过渡效果</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>空状态智能处理</span>
                            </div>
                        </div>
                    </div>
                    <div class="code-block hidden">
                        <pre><code class="language-javascript">// 渲染收藏列表
renderFavorites: function() {
    const favoritesList = document.getElementById('favoritesList');
    const emptyFavorites = document.getElementById('emptyFavorites');
    
    // 如果元素不存在，可能是在推荐页面，直接返回
    if (!favoritesList || !emptyFavorites) {
        return;
    }
    
    // 筛选出收藏的课程 - 确保ID类型一致
    const favoriteCourses = this.courses.filter(course => 
        course.id && this.favorites.some(id => parseInt(id) === parseInt(course.id))
    );
    
    // 如果没有收藏，显示空状态
    if (this.favorites.length === 0 || favoriteCourses.length === 0) {
        favoritesList.innerHTML = '';
        emptyFavorites.classList.remove('d-none');
        return;
    }
    
    // 隐藏空状态
    emptyFavorites.classList.add('d-none');
    favoritesList.innerHTML = '';
    
    // 渲染收藏课程
    favoriteCourses.forEach(course => {
        const courseCard = document.createElement('div');
        courseCard.className = 'col-md-6 col-lg-4 mb-4';
        courseCard.innerHTML = `
            <div class="card course-card" data-id="${course.id}">
                <span class="favorite-badge"><i class="fas fa-heart mr-1"></i>已收藏</span>
                <div class="card-body">
                    <h5 class="card-title">${course.title}</h5>
                    <div class="course-info">
                        <span><i class="fas fa-user mr-1"></i>${course.teacher || '未知教师'}</span>
                    </div>
                    <div class="course-actions mt-3">
                        <button class="btn btn-outline-danger btn-sm toggle-favorite" data-id="${course.id}">
                            <i class="fas fa-heart mr-1"></i>取消收藏
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        favoritesList.appendChild(courseCard);
    });
    
    // 绑定收藏课程卡片事件
    this.bindFavoriteCardEvents();
},

bindFavoriteCardEvents: function() {
    // 收藏按钮点击事件
    document.querySelectorAll('#favoritesList .toggle-favorite').forEach(button => {
        button.addEventListener('click', async (e) => {
            const courseId = parseInt(e.currentTarget.getAttribute('data-id'));
            this.toggleFavorite(courseId);
            
            // 获取要移除的卡片元素
            const card = e.currentTarget.closest('.col-md-6');
            
            // 添加收缩动画
            card.style.transition = 'all 0.3s ease-out';
            card.style.transform = 'scale(0.8)';
            card.style.opacity = '0';
            
            // 等待动画完成后更新收藏区域
            await new Promise(resolve => setTimeout(resolve, 300));
            this.renderFavorites();
            
            // 保存用户数据
            this.saveUserData();
        });
    });
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 系统安全与性能优化 -->
        <section id="security-performance" class="section">
            <div class="section-header">
                <h2><i class="fas fa-shield-alt"></i> 系统安全与性能优化</h2>
                <button class="toggle-btn" aria-label="展开/折叠内容">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <div class="security-performance-grid">
                    <!-- 安全措施 -->
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h3>安全措施</h3>
                        <ul class="feature-list">
                            <li>
                                <strong>密码加密：</strong>使用bcrypt进行密码哈希，确保即使数据库泄露也不会暴露用户密码
                                <div class="code-snippet">
                                    <pre><code class="language-javascript">// 密码加密
const saltRounds = 10;
const hashedPassword = await bcrypt.hash(userData.password, saltRounds);</code></pre>
                                </div>
                            </li>
                            <li>
                                <strong>SQL注入防护：</strong>使用参数化查询，防止SQL注入攻击
                                <div class="code-snippet">
                                    <pre><code class="language-javascript">// 安全的参数化查询
const [rows] = await pool.query('SELECT * FROM users WHERE email = ?', [email]);</code></pre>
                                </div>
                            </li>
                            <li>
                                <strong>JWT认证：</strong>使用JWT进行用户认证，避免会话固定攻击
                            </li>
                            <li>
                                <strong>输入验证：</strong>使用express-validator验证用户输入，防止恶意数据
                            </li>
                        </ul>
                    </div>

                    <!-- 性能优化 -->
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h3>性能优化</h3>
                        <ul class="feature-list">
                            <li>
                                <strong>数据库连接池：</strong>使用连接池管理数据库连接，提高性能和可靠性
                                <div class="code-snippet">
                                    <pre><code class="language-javascript">// 创建数据库连接池
const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});</code></pre>
                                </div>
                            </li>
                            <li>
                                <strong>请求限流：</strong>实现API请求限流，防止DoS攻击
                            </li>
                            <li>
                                <strong>资源压缩：</strong>使用gzip压缩响应内容，减少传输数据量
                            </li>
                            <li>
                                <strong>日志分级：</strong>使用Winston实现日志分级，便于问题排查
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 项目部署与维护 -->
        <section id="deployment" class="section">
            <div class="section-header">
                <h2><i class="fas fa-server"></i> 项目部署与维护</h2>
                <button class="toggle-btn" aria-label="展开/折叠内容">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <div class="deployment-steps">
                    <h3>部署流程</h3>
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>环境准备</h4>
                            <p>确保服务器已安装Node.js、MySQL和必要的依赖项。</p>
                            <div class="code-snippet">
                                <pre><code class="language-bash"># 安装Node.js和npm
sudo apt update
sudo apt install nodejs npm

# 安装MySQL
sudo apt install mysql-server

# 配置MySQL
sudo mysql_secure_installation</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>克隆代码库</h4>
                            <p>从Git仓库克隆项目代码。</p>
                            <div class="code-snippet">
                                <pre><code class="language-bash">git clone <repository-url>
cd Lac</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>配置环境变量</h4>
                            <p>创建.env文件并配置必要的环境变量。</p>
                            <div class="code-snippet">
                                <pre><code class="language-bash"># .env文件示例
PORT=3000
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=courser_db
DB_PORT=3306
JWT_SECRET=your_jwt_secret
JWT_EXPIRES_IN=7d
DEEPSEEK_API_KEY=your_deepseek_api_key</code></pre>
                            </div>
                        </div>
                    </div>
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>安装依赖并启动</h4>
                            <p>安装项目依赖并启动服务。</p>
                            <div class="code-snippet">
                                <pre><code class="language-bash"># 安装后端依赖
cd server
npm install

# 启动后端服务
npm start

# 在另一个终端中启动前端服务
cd ../client
npm install -g http-server
http-server -p 8080</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="maintenance">
                    <h3>维护与监控</h3>
                    <div class="maintenance-grid">
                        <div class="maintenance-item">
                            <i class="fas fa-chart-line"></i>
                            <h4>性能监控</h4>
                            <p>使用Winston日志系统记录API请求和错误信息，便于问题排查和性能分析。</p>
                        </div>
                        <div class="maintenance-item">
                            <i class="fas fa-database"></i>
                            <h4>数据备份</h4>
                            <p>定期备份MySQL数据库，确保数据安全。</p>
                            <div class="code-snippet">
                                <pre><code class="language-bash"># 数据库备份脚本
mysqldump -u root -p courser_db > backup_$(date +%Y%m%d).sql</code></pre>
                            </div>
                        </div>
                        <div class="maintenance-item">
                            <i class="fas fa-code-branch"></i>
                            <h4>版本更新</h4>
                            <p>使用Git进行版本控制，确保代码更新的平滑过渡。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 项目总结 -->
        <section id="summary" class="section">
            <div class="section-header">
                <h2><i class="fas fa-flag-checkered"></i> 项目总结</h2>
                <button class="toggle-btn" aria-label="展开/折叠内容">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="section-content">
                <div class="summary-content">
                    <h3>技术亮点</h3>
                    <div class="highlights-grid">
                        <div class="highlight-item">
                            <i class="fas fa-layer-group"></i>
                            <h4>前后端分离架构</h4>
                            <p>采用前后端分离架构，提高了系统的可维护性和扩展性。前端使用原生JavaScript和Bootstrap构建响应式界面，后端使用Express.js提供RESTful API。</p>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-robot"></i>
                            <h4>AI集成</h4>
                            <p>集成Deepseek API实现智能课程表解析，大大提高了用户体验和数据处理效率。</p>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-shield-alt"></i>
                            <h4>安全性设计</h4>
                            <p>全面的安全措施，包括密码加密、SQL注入防护、JWT认证和输入验证，确保系统和用户数据安全。</p>
                        </div>
                        <div class="highlight-item">
                            <i class="fas fa-tachometer-alt"></i>
                            <h4>性能优化</h4>
                            <p>通过数据库连接池、请求限流和资源压缩等技术，优化系统性能，提供流畅的用户体验。</p>
                        </div>
                    </div>

                    <h3>未来展望</h3>
                    <div class="future-plans">
                        <div class="plan-item">
                            <i class="fas fa-mobile-alt"></i>
                            <h4>移动应用开发</h4>
                            <p>计划开发移动应用版本，提供更便捷的移动学习体验。</p>
                        </div>
                        <div class="plan-item">
                            <i class="fas fa-comments"></i>
                            <h4>社区互动功能</h4>
                            <p>增加课程评论、笔记分享等社区互动功能，促进用户交流。</p>
                        </div>
                        <div class="plan-item">
                            <i class="fas fa-chart-pie"></i>
                            <h4>学习数据分析</h4>
                            <p>添加学习数据分析功能，为用户提供个性化学习建议。</p>
                        </div>
                        <div class="plan-item">
                            <i class="fas fa-globe"></i>
                            <h4>国际化支持</h4>
                            <p>增加多语言支持，扩大用户群体范围。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2023 Courser - 在线网课学习平台</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="script.js"></script>
<!-- 在 body 标签结束前添加 -->
<div class="code-modal" id="codeModal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <pre><code class="modal-code-content"></code></pre>
    </div>
</div>
</body>
</html>